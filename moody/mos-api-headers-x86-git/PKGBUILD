# Maintainer: Moody <mooodyhunter@outlook.com>

_arch=x86
_target=i686-mos
_sysroot=/usr/${_target}
_pkgbase=mos-api-headers-${_arch}

pkgname=${_pkgbase}-git
pkgver=1102.2b04350
pkgrel=1
pkgdesc="MOS API headers for ${_arch}"
arch=('any')
url="https://github.com/moodyhunter/MOS"
license=('GPL3')
provides=($pkgname ${_pkgbase})
conflicts=(${_pkgbase})
groups=(mos-toolchain)
makedepends=(git cmake python)
source=("mos::git+https://github.com/moodyhunter/MOS.git")
sha512sums=('SKIP')

pkgver() {
    cd mos
    printf "%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
    cd mos
    mkdir build && cd build
    cmake .. \
        -DMOS_ARCH=x86 \
        -D__MOS_HAS_NO_COMPILER=ON \
        -DCMAKE_INSTALL_PREFIX=${pkgdir}/usr/$_target

    cmake --build . --target mos_syscall_decl
}

package() {
    cd mos/build
    cmake --install . --component mos-api-headers
}
