# Maintainer: Antonio Rojas <arojas@archlinux.org>
# Maintainer: Felix Yan <felixonmars@archlinux.org>
# Contributor: Andrea Scarpino <andrea@archlinux.org>

_pkgname=qt6-wayland
pkgname=${_pkgname}-hidpi-preferred
_qtver=6.4.0
pkgver=${_qtver/-/}
pkgrel=4
arch=(x86_64)
url='https://www.qt.io'
license=(GPL3 LGPL3 FDL custom)
pkgdesc='Provides APIs for Wayland - HiDPI preferred patch'
depends=(qt6-declarative libxcomposite)
makedepends=(cmake ninja)
provides=(qt6-wayland)
conflicts=(qt6-wayland)
options=(debug)
_pkgfn=${_pkgname/6-/}-everywhere-src-$_qtver
source=(https://download.qt.io/official_releases/qt/${pkgver%.*}/$_qtver/submodules/$_pkgfn.tar.xz
    hidpi.patch)
sha256sums=('f08ba8e14fbec34d57332ad897c5a9150453ed07a611abb18c89c6cc5e5b62fc'
            '3100c9642635af1fc16d64574722827a07762ef562cff72a2b2af6ba7910b85c')

prepare() {
  cd $_pkgfn
  patch -Np1 < ../hidpi.patch
}

build() {
  cmake -B build -S $_pkgfn -G Ninja \
    -DCMAKE_MESSAGE_LOG_LEVEL=STATUS
  cmake --build build
}

package() {
  DESTDIR="$pkgdir" cmake --install build

  install -d "$pkgdir"/usr/share/licenses
  ln -s /usr/share/licenses/qt6-base "$pkgdir"/usr/share/licenses/$_pkgname
}
